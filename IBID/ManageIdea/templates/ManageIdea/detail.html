
{% extends 'base.html'%}

{% load crispy_forms_tags %}
{% load idea_extras %}

{% block body_block %}
<div class="panel panel-default">
	<div class="panel-heading clearfix" >
		<h3 class="panel-title pull-left" style="padding-top: 5px;">
			<span class="glyphicon glyphicon-grain" aria-hidden="true"></span> 
			<b>{{ Idea.title }}</b> 
			{% if Idea.originator %}
				von
				{% for member in Idea.members.all %} 
					{% if not forloop.first %},{% endif %}
					{% if forloop.last %} und {% endif %}
					<b><a href="{% url 'ManageUsers:userprofile' member.id %}">{{ member.first_name }} {{ member.last_name }}</a></b>

				{% endfor %} 
			{% endif %}
		</h3>  
	</div>
	<div class="panel-body">
		<div class="clearfix">
	        <div class="pull-right">
	          {% if request.user|can_edit:Idea %}
				<a href="{% url 'ManageIdea:edit' Idea.id %}" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
				</a>
			{% endif %}
	        </div>
	        <h4> Steckbrief </h4>
	     </div><hr>
		{% crispy detail_form %}
		
		{% if IdeaPrivacy.members_ip or request.user|can_view:Idea and Idea.members%}
		<div class="clearfix">
	        <div class="pull-right">
		         {% if request.user|can_edit:Idea %}
					<a href="{% url 'ManageIdea:add_member' Idea.id %}" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
					</a>
				{% endif %}
			</div>
	        <h4> Zugeh√∂rige Personen </h4>
	    </div><hr>
		

		
			{% for membership in Idea.membership_set.all %}
			<div class="row">
				<div class="col-md-1 col-sm-1">
					<span class="glyphicon glyphicon-pawn" aria-hidden="true"></span>
				</div>

				<div class="col-md-10 col-sm-10">
					<p class="list-group-item-text">
						<b><a href="{% url 'ManageUsers:userprofile' membership.member.id %}">{{ membership.member }}</a></b> 
						{% if request.user|can_edit:membership %}(<a href="{% url 'ManageIdea:edit_membership' Idea.id membership.id %}">edit</a>)
						{% endif %}
					</p>
					<p>{{membership.task}}</p>
				</div>
				<div class="col-md-1 col-sm-1">
				</div>
			</div>
			{% endfor %}
		
		{% endif %}
		
		{% if request.user|has_group:"staff" %}
		<div class="clearfix">
	        <div class="pull-right">
		        <div class="btn-group pull-right">
					<a class="btn btn-default btn-sm" data-toggle="modal" data-target="#createCommentModal">
						<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
					</a>

					<!-- Modal -->
					<div class="modal fade" id="createCommentModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="myModalLabel">Notiz hinterlassen</h4>
								</div>
								<div class="modal-body">
									<form action="{% url 'ManageIdea:createcomment' Idea.id %}" method="POST">
										{% csrf_token %}
										{% crispy commentform %}
										<input type="submit" class="btn btn-submit col-md-offset-2">
									</form>
								</div>

							</div>
						</div>
					</div>
					
				</div>
			</div>
	        <h4> Notizen </h4>
	    </div><hr>
		
			{% for comment in comments %}
			{% if Idea.owner|can_view:comment and request.user|can_view:Idea or request.user|has_group:"staff" %}
			<div class="row">
				<div class="col-md-1 col-sm-1">
					<span class="glyphicon glyphicon-comment" aria-hidden="true"></span>
				</div>
				<div class="col-md-10 col-sm-10">
					<p class="list-group-item-text">
						<b >{{ comment.title }} </b> by <a href="{% url 'ManageUsers:userprofile' comment.supervisor.id %}"> {{ comment.supervisor }} </a> 
						{% if request.user|can_edit:comment%}
							(<a href="{% url 'ManageIdea:edit_comment' comment.id %}">edit</a>)
						{% endif %}
						<p class="list-group-item-text">{{ comment.message|linebreaks }}</p>
					</p>
				</div>
				<div class="col-md-1 col-sm-1">
				</div>
			</div>
			{% endif %}
			{% endfor %}
		{% endif %}
	</div>
</div>

{% endblock %}

